# ðŸŽ“ FPMI RAG Bot

Ð¢ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼-Ð±Ð¾Ñ‚ Ñ Ð¸ÑÐºÑƒÑÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼ Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚Ð¾Ð¼, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ 
Ð¾ Ð¤Ð°ÐºÑƒÐ»ÑŒÑ‚ÐµÑ‚Ðµ Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ð½Ð¾Ð¹ Ð¼Ð°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐ¸ Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸ÐºÐ¸ (Ð¤ÐŸÐœÐ˜) Ð‘Ð“Ð£.
Ð‘Ð¾Ñ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñƒ **RAG (Retrieval-Augmented Generation)**: 
Ð¾Ð½ Ð¸Ñ‰ÐµÑ‚ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð½Ð° Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¼ ÑÐ°Ð¹Ñ‚Ðµ Ñ„Ð°ÐºÑƒÐ»ÑŒÑ‚ÐµÑ‚Ð° Ð¸ Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ LLM (Llama 3.1).



## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚ (macOS / Linux)

Ð”Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ **Docker** Ð¸ **Docker Compose**. \
Ð¢Ð°Ðº Ð¶Ðµ Ð²Ð°Ð¶Ð½Ð¾ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸Ð´Ñ‚Ð¸ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð¾Ð»Ð³Ð¾. Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ð¾ ÑÑ‚Ð¾ Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹ Ð²ÑÐµÑ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸ÐµÐ¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### 1. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

1.  Ð¡ÐºÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹.
2.  Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env` Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°:
    ```bash
    cp .env.example .env
    ```
3.  ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ `.env` Ð¸ Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¾Ñ‚Ð° Ð² `TGSERVER__TOKEN`. ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ.

### 2. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸. ÐžÐ½ ÑÐ¾Ð±ÐµÑ€ÐµÑ‚ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹, ÑÐºÐ°Ñ‡Ð°ÐµÑ‚ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚ÑŒ, ÑÐ¾Ð·Ð´Ð°ÑÑ‚ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð¿Ñ€Ð¾Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€ÑƒÐµÑ‚ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ ÑÐ°Ð¹Ñ‚Ð°.

```bash
chmod +x setup.sh
./setup.sh
```

### 3. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Telegram (Localtunnel)

Ð¢Ð°Ðº ÐºÐ°Ðº Ð±Ð¾Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾, Telegram Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ ÐµÐ¼Ñƒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ. ÐÑƒÐ¶Ð½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚ÑƒÐ½Ð½ÐµÐ»ÑŒ.

1.  ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ **Ð½Ð¾Ð²Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ð°**.
2.  Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¸ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ `localtunnel` (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Node.js):
    ```bash
    npx localtunnel --port 8080 --subdomain famcs-answer-bot
    ```
    *(Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð´Ð´Ð¾Ð¼ÐµÐ½ Ð·Ð°Ð½ÑÑ‚, ÑƒÐ±ÐµÑ€Ð¸Ñ‚Ðµ Ñ„Ð»Ð°Ð³ `--subdomain` Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ).*

3.  Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `https://famcs-answer-bot.loca.lt`).
4.  ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env` Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ `TGSERVER__WEBHOOK_URL`.
    **Ð’ÐÐ–ÐÐž:** ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ `/webhook` Ð² ÐºÐ¾Ð½Ñ†Ðµ ÑÑÑ‹Ð»ÐºÐ¸!
    ```ini
    TGSERVER__WEBHOOK_URL=https://famcs-answer-bot.loca.lt/webhook
    ```
5.  ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð±Ð¾Ñ‚Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ:
    ```bash
    docker-compose restart bot
    ```

ðŸŽ‰ **Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!** ÐœÐ¾Ð¶Ð½Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð±Ð¾Ñ‚Ñƒ `/start` Ð¸ Ð·Ð°Ð´Ð°Ñ‚ÑŒ ÐµÐ¼Ñƒ ÑÐ²Ð¾Ð¹ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ: "ÐšÑ‚Ð¾ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð´ÐµÐºÐ°Ð½Ð¾Ð¼ Ñ„Ð°ÐºÑƒÐ»ÑŒÑ‚ÐµÑ‚Ð° Ð² Ð½Ð°ÑÑ‚Ð¾ÑÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ?". \
Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°, Ð²Ð²ÐµÐ´Ð¸ `docker-compose down -v`

#### Ð’Ð°Ð¶Ð½Ð¾

Ð‘Ð¾Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ñ‚ÑŒ Ð½Ðµ Ð±Ñ‹ÑÑ‚Ñ€Ð¾, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ -- ÑÐ»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÐµÐ¼ Ð² Ð»Ð¾Ð³Ð°Ñ… 

---

## ðŸ›  Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº (ÐµÑÐ»Ð¸ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»)

Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑˆÐ°Ð³, Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ (Ñ‚Ð°Ðº Ð¶Ðµ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¼ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¾Ð¼ Ð¿Ð¾ÑÐ»ÑƒÐ¶Ð¸Ñ‚ ÑÐ°Ð¼ Ñ„Ð°Ð¹Ð» [setup.sh](setup.sh)):

1.  **Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²:**
    ```bash
    docker-compose up -d --build
    ```

2.  **Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° LLM (Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°):**
    ```bash
    docker-compose exec ollama ollama pull llama3.1
    ```

3.  **ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…:**
    ```bash
    docker-compose exec rag-cli alembic upgrade head
    ```

4.  **Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð¡Ð±Ð¾Ñ€ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ñ ÑÐ°Ð¹Ñ‚Ð°):**
    Ð‘ÐµÐ· ÑÑ‚Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð° Ð±Ð¾Ñ‚ Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð½Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð².
    ```bash
    # Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ (Ð±Ñ‹ÑÑ‚Ñ€Ð¾, Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†)
    docker-compose exec rag-cli python main.py index test
    ```

---

## ðŸ§  Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð» Ð¸ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» RAG-ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹:

1.  **Indexing (Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ):**
    *   ÐŸÐ°Ñ€ÑÐ¸Ð½Ð³ HTML ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ† (Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° ÑÐ¿Ð¸ÑÐºÐ¾Ð², Ñ‚Ð°Ð±Ð»Ð¸Ñ†, ÑÑ‚Ð°Ñ‚ÐµÐ¹).
    *   ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð¾Ñ‚ ÑˆÑƒÐ¼Ð° (Ð¼ÐµÐ½ÑŽ, Ñ„ÑƒÑ‚ÐµÑ€Ñ‹).
    *   Ð Ð°Ð·Ð±Ð¸ÐµÐ½Ð¸Ðµ Ð½Ð° Ñ‡Ð°Ð½ÐºÐ¸ (Semantic Chunking).
    *   Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ñ‹Ñ… ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¾Ð² (Ð¼Ð¾Ð´ÐµÐ»ÑŒ `intfloat/multilingual-e5-large`).
    *   Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² **ChromaDB** (Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº) Ð¸ **BM25** (Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ ÑÐ»Ð¾Ð²Ð°Ð¼).

2.  **Retrieval (ÐŸÐ¾Ð¸ÑÐº):** 
    *   Ð“Ð¸Ð±Ñ€Ð¸Ð´Ð½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº (Vector + Keyword).
    *   **Query Expansion:** LLM Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ¸Ð½Ð¾Ð½Ð¸Ð¼Ñ‹ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ° Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°.
      * Ð´Ð»Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿Ð¾ÐºÐ° Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½
    *   **Re-ranking:** ÐŸÐµÑ€ÐµÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Cross-Encoder Ð´Ð»Ñ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ð¸.
      *  Ð´Ð»Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿Ð¾ÐºÐ° Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½

3.  **Generation (Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ):**
    *   LLM (**Llama 3.1** Ñ‡ÐµÑ€ÐµÐ· Ollama) Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°.

4.  **Telegram Bot:**
    *   ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚ Ð½Ð° **aiogram 3.x**.
    *   Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² Ð² **PostgreSQL**.
    *   Dependency Injection ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸.

## ðŸŽ› CLI ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ (Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ RAG-Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½Ð¾Ð¼)

Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ°Ð¼Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ð¸ Ð¸ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ ÑÐµÑ€Ð²Ð¸Ñ `rag-cli`.

### 1. Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ (Ð¡Ð±Ð¾Ñ€ Ð´Ð°Ð½Ð½Ñ‹Ñ…)
Ð—Ð°Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½ÑƒÑŽ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÐµÐ¹ Ñ ÑÐ°Ð¹Ñ‚Ð°.
**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð¡Ð¾Ð·Ð´Ð°ÑŽÑ‚ÑÑ Ð¸Ð½Ð´ÐµÐºÑÑ‹ (ChromaDB + BM25), Ð° Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… Ñ‡Ð°Ð½ÐºÐ¾Ð² ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð² Ñ„Ð°Ð¹Ð» `output/indexing.txt` Ð´Ð»Ñ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸.

*   **Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ (Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼):**
    ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ URL, ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ðµ Ð² `config.yaml` Ð² ÑÐµÐºÑ†Ð¸Ð¸ `test_urls`. Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¿Ð°Ñ€ÑÐµÑ€Ð°.
    ```bash
    docker-compose exec rag-cli python main.py index test
    ```

*   **ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ (Prod Ñ€ÐµÐ¶Ð¸Ð¼):**
    Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ ÐºÑ€Ð°ÑƒÐ»ÐµÑ€, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¾Ð±Ñ…Ð¾Ð´Ð¸Ñ‚ Ð²ÐµÑÑŒ ÑÐ°Ð¹Ñ‚ (Ð½Ð° Ð³Ð»ÑƒÐ±Ð¸Ð½Ñƒ `max_depth` Ð¸Ð· ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð°) Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€ÑƒÐµÑ‚ Ð²ÑÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹.
    ```bash
    docker-compose exec rag-cli python main.py index
    ```

### 2. Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð¸ÑÐºÐ° (Retrieve)
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚, ÐºÐ°ÐºÐ¸Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ (Ñ‡Ð°Ð½ÐºÐ¸) ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð°, Ð½Ð¾ **Ð½Ðµ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚** ÑÐ°Ð¼ Ð¾Ñ‚Ð²ÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· LLM. ÐŸÐ¾Ð»ÐµÐ·Ð½Ð¾ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸ Ñ€ÐµÑ‚Ñ€Ð¸Ð²ÐµÑ€Ð°.

*   **ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑƒ:**
    Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¿Ñ€ÑÐ¼Ð¾ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ.
    ```bash
    docker-compose exec rag-cli python main.py retrieve -q "ÐšÑ‚Ð¾ Ð´ÐµÐºÐ°Ð½ Ñ„Ð°ÐºÑƒÐ»ÑŒÑ‚ÐµÑ‚Ð°?"
    ```

*   **ÐŸÐ°ÐºÐµÑ‚Ð½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (Evaluation):**
    ÐŸÑ€Ð¾Ð³Ð¾Ð½ÑÐµÑ‚ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ Ð²ÑÐµÐ¼ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° `qa-test-set.yaml`. Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² Ñ„Ð°Ð¹Ð» `output/retriever.txt`.
    ```bash
    docker-compose exec rag-cli python main.py retrieve
    ```

### 3. Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð° (Answer)
Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ RAG-Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½: ÐŸÐ¾Ð¸ÑÐº + Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ñ‡ÐµÑ€ÐµÐ· LLM.

*   **ÐžÑ‚Ð²ÐµÑ‚ Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ:**
    Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¸ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ ÐµÐ³Ð¾ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ.
    ```bash
    docker-compose exec rag-cli python main.py answer -q "ÐšÐ°ÐºÐ¸Ðµ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð±Ð°Ð»Ð»Ñ‹ Ð±Ñ‹Ð»Ð¸ Ð² 2025 Ð³Ð¾Ð´Ñƒ?"
    ```

*   **ÐŸÐ°ÐºÐµÑ‚Ð½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (Evaluation):**
    Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ð²ÑÐµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð· `qa-test-set.yaml`. Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ (Ð²Ð¾Ð¿Ñ€Ð¾Ñ, Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚, Ð¾Ñ‚Ð²ÐµÑ‚ Ð±Ð¾Ñ‚Ð°) ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² `output/answer.txt`.
    ```bash
    docker-compose exec rag-cli python main.py answer
    ```

## ðŸ“‚ ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

*   **ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð»Ð¾Ð³Ð¸ Ð±Ð¾Ñ‚Ð°:**
    ```bash
    docker-compose logs -f bot
    ```
*   **ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹:**
    ```bash
    docker-compose down
    ```

*   **Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð‘Ð”**
    ```bash
    docker-compose exec rag-cli alembic revision --autogenerate -m "Auto migration" 2>/dev/null || true
    ```