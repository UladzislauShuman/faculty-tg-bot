# üéì FPMI RAG Bot

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã 
–æ –§–∞–∫—É–ª—å—Ç–µ—Ç–µ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏ (–§–ü–ú–ò) –ë–ì–£.
–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É **RAG (Retrieval-Augmented Generation)**: 
–æ–Ω –∏—â–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å –ø–æ–º–æ—â—å—é LLM (Llama 3.1).



## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (macOS / Linux)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π **Docker** –∏ **Docker Compose**. \
–¢–∞–∫ –∂–µ –≤–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–æ–∂–µ—Ç –∏–¥—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ. –°–≤—è–∑–∞–Ω–Ω–æ —ç—Ç–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1.  –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
2.  –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:
    ```bash
    cp .env.example .env
    ```
3.  –û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ `TGSERVER__TOKEN`. –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –û–Ω —Å–æ–±–µ—Ä–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–∫–∞—á–∞–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç—å, —Å–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞.

```bash
chmod +x setup.sh
./setup.sh
```

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram (Localtunnel)

–¢–∞–∫ –∫–∞–∫ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, Telegram –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é. –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç—É–Ω–Ω–µ–ª—å.

1.  –û—Ç–∫—Ä–æ–π—Ç–µ **–Ω–æ–≤–æ–µ –æ–∫–Ω–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞**.
2.  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `localtunnel` (—Ç—Ä–µ–±—É–µ—Ç—Å—è Node.js):
    ```bash
    npx localtunnel --port 8080 --subdomain famcs-answer-bot
    ```
    *(–ï—Å–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω –∑–∞–Ω—è—Ç, —É–±–µ—Ä–∏—Ç–µ —Ñ–ª–∞–≥ `--subdomain` –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π –∞–¥—Ä–µ—Å).*

3.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://famcs-answer-bot.loca.lt`).
4.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TGSERVER__WEBHOOK_URL`.
    **–í–ê–ñ–ù–û:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ `/webhook` –≤ –∫–æ–Ω—Ü–µ —Å—Å—ã–ª–∫–∏!
    ```ini
    TGSERVER__WEBHOOK_URL=https://famcs-answer-bot.loca.lt/webhook
    ```
5.  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å:
    ```bash
    docker-compose restart bot
    ```

üéâ **–ì–æ—Ç–æ–≤–æ!** –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –±–æ—Ç—É `/start` –∏ –∑–∞–¥–∞—Ç—å –µ–º—É —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å: "–ö—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –¥–µ–∫–∞–Ω–æ–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è?". \
–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞, –≤–≤–µ–¥–∏ `docker-compose down -v`

#### –í–∞–∂–Ω–æ

–ë–æ—Ç –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–µ –±—ã—Å—Ç—Ä–æ, –ø–æ—ç—Ç–æ–º—É -- —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤ –ª–æ–≥–∞—Ö 

---

## üõ† –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (—Ç–∞–∫ –∂–µ —Ö–æ—Ä–æ—à–∏–º –ø—Ä–∏–º–µ—Ä–æ–º –ø–æ—Å–ª—É–∂–∏—Ç —Å–∞–º —Ñ–∞–π–ª [setup.sh](setup.sh)):

1.  **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:**
    ```bash
    docker-compose up -d --build
    ```

2.  **–ó–∞–≥—Ä—É–∑–∫–∞ LLM (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞):**
    ```bash
    docker-compose exec ollama ollama pull llama3.1
    ```

3.  **–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
    ```bash
    docker-compose exec rag-cli alembic upgrade head
    ```

4.  **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å —Å–∞–π—Ç–∞):**
    –ë–µ–∑ —ç—Ç–æ–≥–æ —à–∞–≥–∞ –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å –æ—Ç–≤–µ—Ç–æ–≤.
    ```bash
    # –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–±—ã—Å—Ç—Ä–æ, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü)
    docker-compose exec rag-cli python main.py index test
    ```

---

## üß† –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª RAG-—Å–∏—Å—Ç–µ–º—ã:

1.  **Indexing (–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è):**
    *   –ü–∞—Ä—Å–∏–Ω–≥ HTML —Å—Ç—Ä–∞–Ω–∏—Ü (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–∏—Å–∫–æ–≤, —Ç–∞–±–ª–∏—Ü, —Å—Ç–∞—Ç–µ–π).
    *   –û—á–∏—Å—Ç–∫–∞ –æ—Ç —à—É–º–∞ (–º–µ–Ω—é, —Ñ—É—Ç–µ—Ä—ã).
    *   –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ (Semantic Chunking).
    *   –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–º–æ–¥–µ–ª—å `intfloat/multilingual-e5-large`).
    *   –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ **ChromaDB** (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫) –∏ **BM25** (–ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º).

2.  **Retrieval (–ü–æ–∏—Å–∫):** 
    *   –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Vector + Keyword).
    *   **Query Expansion:** LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–∏—Å–∫–∞.
      * –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω
    *   **Re-ranking:** –ü–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é Cross-Encoder –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.
      *  –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω

3.  **Generation (–ì–µ–Ω–µ—Ä–∞—Ü–∏—è):**
    *   LLM (**Llama 3.1** —á–µ—Ä–µ–∑ Ollama) —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

4.  **Telegram Bot:**
    *   –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –±–æ—Ç –Ω–∞ **aiogram 3.x**.
    *   –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –≤ **PostgreSQL**.
    *   Dependency Injection –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

## üéõ CLI –ö–æ–º–∞–Ω–¥—ã (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RAG-–ø–∞–π–ø–ª–∞–π–Ω–æ–º)

–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å, –∏—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ä–≤–∏—Å `rag-cli`.

### 1. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è (–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)
–ó–∞–ø–æ–ª–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π —Å —Å–∞–π—Ç–∞.
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã (ChromaDB + BM25), –∞ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª `output/indexing.txt` –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.

*   **–ë—ã—Å—Ç—Ä–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º):**
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ URL, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `config.yaml` –≤ —Å–µ–∫—Ü–∏–∏ `test_urls`. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞.
    ```bash
    docker-compose exec rag-cli python main.py index test
    ```

*   **–ü–æ–ª–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è (Prod —Ä–µ–∂–∏–º):**
    –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫—Ä–∞—É–ª–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç –≤–µ—Å—å —Å–∞–π—Ç (–Ω–∞ –≥–ª—É–±–∏–Ω—É `max_depth` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞) –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    ```bash
    docker-compose exec rag-cli python main.py index
    ```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞ (Retrieve)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (—á–∞–Ω–∫–∏) —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–∞, –Ω–æ **–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç** —Å–∞–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞.

*   **–ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤–æ–ø—Ä–æ—Å—É:**
    –í—ã–≤–æ–¥–∏—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Å–æ–ª—å.
    ```bash
    docker-compose exec rag-cli python main.py retrieve -q "–ö—Ç–æ –¥–µ–∫–∞–Ω —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞?"
    ```

*   **–ü–∞–∫–µ—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Evaluation):**
    –ü—Ä–æ–≥–æ–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –∏–∑ —Ñ–∞–π–ª–∞ `qa-test-set.yaml`. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª `output/retriever.txt`.
    ```bash
    docker-compose exec rag-cli python main.py retrieve
    ```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ (Answer)
–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–π RAG-–ø–∞–π–ø–ª–∞–π–Ω: –ü–æ–∏—Å–∫ + –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ LLM.

*   **–û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å:**
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –∏ –≤—ã–≤–æ–¥–∏—Ç –µ–≥–æ –≤ –∫–æ–Ω—Å–æ–ª—å.
    ```bash
    docker-compose exec rag-cli python main.py answer -q "–ö–∞–∫–∏–µ –ø—Ä–æ—Ö–æ–¥–Ω—ã–µ –±–∞–ª–ª—ã –±—ã–ª–∏ –≤ 2025 –≥–æ–¥—É?"
    ```

*   **–ü–∞–∫–µ—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Evaluation):**
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ `qa-test-set.yaml`. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–≤–æ–ø—Ä–æ—Å, –æ–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç, –æ—Ç–≤–µ—Ç –±–æ—Ç–∞) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `output/answer.txt`.
    ```bash
    docker-compose exec rag-cli python main.py answer
    ```

## üìÇ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

*   **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞:**
    ```bash
    docker-compose logs -f bot
    ```
*   **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:**
    ```bash
    docker-compose down
    ```

*   **–°–¥–µ–ª–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î**
    ```bash
    docker-compose exec rag-cli alembic revision --autogenerate -m "Auto migration" 2>/dev/null || true
    ```
## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π CLI-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π RAG.
–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `data/chroma_db_semantic`)

### 1. –ó–∞–ø—É—Å–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥–Ω—è—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–π—Ä–æ—Å–µ—Ç—å –∏ CLI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
docker-compose up -d ollama postgres rag-cli
```
*(–ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫, –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π –≤ –ª–æ–≥–∞—Ö `ollama`)*.

### 2. –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `rag-cli`:

```bash
docker-compose exec rag-cli python main.py test [–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏—è | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `--chunker` | `markdown`, `semantic`, `unstructured` | –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞. –í–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. |
| `--retriever` | `hybrid`, `vector` | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞. –í–ª–∏—è–µ—Ç –Ω–∞ Hit Rate (—Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è). |
| `--index-mode` | `test`, `full` | –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö. `test` ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω, `full` ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–±. |
| `--force-index` | –§–ª–∞–≥ | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –Ω—É–ª—è. |

#### –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**1. `--chunker` (–ê–ª–≥–æ—Ä–∏—Ç–º —á–∞–Ω–∫–∏–Ω–≥–∞)**
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏.
*   **`markdown` (Default):** –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å HTML –≤ Markdown, –∑–∞—Ç–µ–º –±—å–µ—Ç –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º (`#`, `##`).
*   **`semantic`:** "–£–º–Ω—ã–π" HTML-–ø–∞—Ä—Å–µ—Ä–∞. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü (`<tr>`) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–º—ã—Å–ª–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü —Ç–∏–ø–∞ "–î–µ–∫–∞–Ω–∞—Ç" –∏–ª–∏ "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ".
*   **–í–∞–∂–Ω–æ:** –ö–∞–∂–¥—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–≤–æ—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `data/chroma_db_markdown` –∏–ª–∏ `data/chroma_db_semantic`), –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π –±–∞–∑—ã.

**2. `--retriever` (–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–∏—Å–∫–∞)**
*   **`hybrid` (Default):** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (—Å–µ–º–∞–Ω—Ç–∏–∫–∞) + BM25 (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞).
*   **`vector`:** –¢–æ–ª—å–∫–æ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (ChromaDB). –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ BM25 —É–ª—É—á—à–∞–µ—Ç (–∏–ª–∏ —É—Ö—É–¥—à–∞–µ—Ç) —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**3. `--index-mode` (–†–µ–∂–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö)**
*   **`test` (Default):** –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ URL, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `config.yaml` –≤ —Å–µ–∫—Ü–∏–∏ `test_urls`.
*   **`full`:** –ó–∞–ø—É—Å–∫–∞–µ—Ç Crawler, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç –≤–µ—Å—å —Å–∞–π—Ç (–¥–æ –≥–ª—É–±–∏–Ω—ã `max_depth`).

**4. `--force-index` (–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è)**
*   –ï—Å–ª–∏ —Ñ–ª–∞–≥ **–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**: –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ –±–∞–∑—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ `--chunker`. –ï—Å–ª–∏ –±–∞–∑–∞ –µ—Å—Ç—å ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ (—ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏). –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞.
*   –ï—Å–ª–∏ —Ñ–ª–∞–≥ **—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**: –°–∫—Ä–∏–ø—Ç **—É–¥–∞–ª–∏—Ç** —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É —Å –±–∞–∑–æ–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–∞–Ω–∫–µ—Ä–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–Ω–æ–≤–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ, –µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–µ—Ä–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏ –∏–ª–∏ —Å–ø–∏—Å–æ–∫ URL.

### –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–π –ê: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (Markdown)**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å (–∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –µ–≥–æ, –µ—Å–ª–∏ –Ω–µ—Ç) –Ω–∞ –º–∞–ª–æ–º –Ω–∞–±–æ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü.
```bash
docker-compose exec rag-cli python main.py test --chunker=markdown
```

**–°—Ü–µ–Ω–∞—Ä–∏–π –ë: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å "–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º" —á–∞–Ω–∫–µ—Ä–æ–º**
–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å —Å –Ω–æ–≤—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º (Semantic Chunking) –∏ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç–µ—Å—Ç—ã.
```bash
docker-compose exec rag-cli python main.py test --chunker=semantic --force-index
```

**–°—Ü–µ–Ω–∞—Ä–∏–π –í: –¢–µ—Å—Ç –Ω–∞ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –≤–µ–¥–µ—Ç —Å–µ–±—è, –µ—Å–ª–∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å —Å–∞–π—Ç —Ü–µ–ª–∏–∫–æ–º.
```bash
docker-compose exec rag-cli python main.py test --chunker=markdown --index-mode=full --force-index
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
–í –∫–æ–Ω—Ü–µ –ø—Ä–æ–≥–æ–Ω–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –æ—Ç—á–µ—Ç:
*   **Hit Rate (Retrieval):** –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞ (–Ω–∞—à–µ–ª –ª–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞).
*   **Similarity (Generation):** –û—Ü–µ–Ω–∫–∞ —Å–º—ã—Å–ª–æ–≤–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞ –∫ —ç—Ç–∞–ª–æ–Ω—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å `rubert-tiny2`).
*   **Latency:** –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.